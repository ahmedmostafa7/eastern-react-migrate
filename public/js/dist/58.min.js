(window["webpackJsonp"] = window["webpackJsonp"] || []).push([[58],{

/***/ "./src/app/components/inputs/fields/table/index.js":
/*!*********************************************************!*\
  !*** ./src/app/components/inputs/fields/table/index.js ***!
  \*********************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var antd_lib_table_style__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! antd/lib/table/style */ "./node_modules/antd/lib/table/style/index.js");
/* harmony import */ var antd_lib_table_style__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(antd_lib_table_style__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var antd_lib_table__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! antd/lib/table */ "./node_modules/antd/lib/table/index.js");
/* harmony import */ var antd_lib_table__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(antd_lib_table__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var antd_lib_popconfirm_style__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! antd/lib/popconfirm/style */ "./node_modules/antd/lib/popconfirm/style/index.js");
/* harmony import */ var antd_lib_popconfirm_style__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(antd_lib_popconfirm_style__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var antd_lib_popconfirm__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! antd/lib/popconfirm */ "./node_modules/antd/lib/popconfirm/index.js");
/* harmony import */ var antd_lib_popconfirm__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(antd_lib_popconfirm__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var antd_lib_button_style__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! antd/lib/button/style */ "./node_modules/antd/lib/button/style/index.js");
/* harmony import */ var antd_lib_button_style__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(antd_lib_button_style__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var antd_lib_button__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! antd/lib/button */ "./node_modules/antd/lib/button/index.js");
/* harmony import */ var antd_lib_button__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(antd_lib_button__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var antd_lib_icon_style__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! antd/lib/icon/style */ "./node_modules/antd/lib/icon/style/index.js");
/* harmony import */ var antd_lib_icon_style__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(antd_lib_icon_style__WEBPACK_IMPORTED_MODULE_6__);
/* harmony import */ var antd_lib_icon__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! antd/lib/icon */ "./node_modules/antd/lib/icon/index.js");
/* harmony import */ var antd_lib_icon__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(antd_lib_icon__WEBPACK_IMPORTED_MODULE_7__);
/* harmony import */ var antd_lib_alert_style__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! antd/lib/alert/style */ "./node_modules/antd/lib/alert/style/index.js");
/* harmony import */ var antd_lib_alert_style__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(antd_lib_alert_style__WEBPACK_IMPORTED_MODULE_8__);
/* harmony import */ var antd_lib_alert__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! antd/lib/alert */ "./node_modules/antd/lib/alert/index.js");
/* harmony import */ var antd_lib_alert__WEBPACK_IMPORTED_MODULE_9___default = /*#__PURE__*/__webpack_require__.n(antd_lib_alert__WEBPACK_IMPORTED_MODULE_9__);
/* harmony import */ var lodash_get__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! lodash/get */ "./node_modules/lodash/get.js");
/* harmony import */ var lodash_get__WEBPACK_IMPORTED_MODULE_10___default = /*#__PURE__*/__webpack_require__.n(lodash_get__WEBPACK_IMPORTED_MODULE_10__);
/* harmony import */ var lodash_isEqual__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! lodash/isEqual */ "./node_modules/lodash/isEqual.js");
/* harmony import */ var lodash_isEqual__WEBPACK_IMPORTED_MODULE_11___default = /*#__PURE__*/__webpack_require__.n(lodash_isEqual__WEBPACK_IMPORTED_MODULE_11__);
/* harmony import */ var lodash_map__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! lodash/map */ "./node_modules/lodash/map.js");
/* harmony import */ var lodash_map__WEBPACK_IMPORTED_MODULE_12___default = /*#__PURE__*/__webpack_require__.n(lodash_map__WEBPACK_IMPORTED_MODULE_12__);
/* harmony import */ var lodash_assign__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! lodash/assign */ "./node_modules/lodash/assign.js");
/* harmony import */ var lodash_assign__WEBPACK_IMPORTED_MODULE_13___default = /*#__PURE__*/__webpack_require__.n(lodash_assign__WEBPACK_IMPORTED_MODULE_13__);
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_14___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_14__);
/* harmony import */ var _mapping__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./mapping */ "./src/app/components/inputs/fields/table/mapping.js");
/* harmony import */ var react_redux__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! react-redux */ "./node_modules/react-redux/es/index.js");
/* harmony import */ var _tableActionFunctions__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./tableActionFunctions */ "./src/app/components/inputs/fields/table/tableActionFunctions.js");
/* harmony import */ var _helpers_fieldValues__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../../../helpers/fieldValues */ "./src/app/helpers/fieldValues/index.js");
/* harmony import */ var react_i18next__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! react-i18next */ "./node_modules/react-i18next/dist/es/index.js");
/* harmony import */ var react_router__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! react-router */ "./node_modules/react-router/es/index.js");
/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! axios */ "./node_modules/axios/index.js");
/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_21___default = /*#__PURE__*/__webpack_require__.n(axios__WEBPACK_IMPORTED_MODULE_21__);






















class tableComponent extends react__WEBPACK_IMPORTED_MODULE_14__["Component"] {
  constructor(props) {
    super(props);
    const {
      fields
    } = props;
    this.state = {
      unfilteredData: {},
      columns: [{}]
    };
    this.tableHeight = 500;
    this.getMoreData = this.getMoreData.bind(this);

    // this.colWidth = 100/(fields.length + 1)+'%';
  }
  tableRenderFunction(field, text, record) {
    return lodash_get__WEBPACK_IMPORTED_MODULE_10___default()(_helpers_fieldValues__WEBPACK_IMPORTED_MODULE_18__, field.field, text => text)(text, record, field, this.props);
  }
  componentDidMount() {
    const {
      fields,
      tableActions,
      t
    } = this.props;
    let columns = fields.map(field => {
      const {
        name,
        label,
        sorter
      } = field;
      return {
        title: t(label),
        key: name,
        dataIndex: name,
        // width: this.colWidth,
        render: this.tableRenderFunction.bind(this, field),
        sorter: sorter ? (a, b) => lodash_get__WEBPACK_IMPORTED_MODULE_10___default()(_tableActionFunctions__WEBPACK_IMPORTED_MODULE_17__, sorter, null)(a, b, name) : null
      };
    });
    const actions = tableActions ? {
      title: "Actions",
      dataIndex: "actions",
      key: "actions",
      render: (text, record, index) => {
        return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_14___default.a.createElement("span", null, lodash_map__WEBPACK_IMPORTED_MODULE_12___default()(tableActions, action => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_14___default.a.createElement("span", {
          key: action.name
        }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_14___default.a.createElement(antd_lib_popconfirm__WEBPACK_IMPORTED_MODULE_3___default.a, {
          title: action.title,
          onConfirm: lodash_get__WEBPACK_IMPORTED_MODULE_10___default()(_tableActionFunctions__WEBPACK_IMPORTED_MODULE_17__, action.function, () => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_14___default.a.createElement(antd_lib_alert__WEBPACK_IMPORTED_MODULE_9___default.a, {
            message: "not a valid action function",
            banner: true
          })).bind(this, record, index, action, this.props),
          icon: /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_14___default.a.createElement(antd_lib_icon__WEBPACK_IMPORTED_MODULE_7___default.a, {
            type: action.icon,
            style: {
              color: action.color
            }
          })
        }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_14___default.a.createElement(antd_lib_button__WEBPACK_IMPORTED_MODULE_5___default.a, {
          type: action.type
        }, t(action.label))))));
      }
    } : null;
    actions ? columns = [...columns, actions] : null;
    if (this.state.columns !== columns) {
      this.setState({
        columns
      });
    }
    this.fetchTableData();
  }
  fetchTableData(recievedUrl) {
    const {
      fillData,
      tableData: {
        method,
        fetchUrl,
        queryParams
      },
      results
    } = this.props;
    const url = recievedUrl && results ? recievedUrl : fetchUrl;
    if (recievedUrl || !results) {
      //setLoading(true)
      axios__WEBPACK_IMPORTED_MODULE_21___default.a[method](url, {
        ...queryParams
      }).then(({
        data
      }) => {
        const recievedData = data.results.map(singleResult => lodash_assign__WEBPACK_IMPORTED_MODULE_13___default()(singleResult, {
          key: singleResult.id
        }));
        const newResults = results ? [...recievedData, ...results] : recievedData;
        fillData({
          ...data,
          results: newResults
        });
        //setLoading(false)
      });
    }
    if (!recievedUrl) {
      !this.tableContent ? this.setScrollEvents() : this.tableContent.scrollTop = 0;
    }
  }
  setScrollEvents() {
    this.tableContent = document.querySelector(".ant-table-body");
    this.tableContent.addEventListener("scroll", this.getMoreData);
  }
  getMoreData(event) {
    const {
      next,
      count,
      results = []
    } = this.props;
    let maxScroll = event.target.scrollHeight - event.target.clientHeight;
    let currentScroll = event.target.scrollTop;
    if (Math.ceil(currentScroll) >= maxScroll - 20) {
      if (next && results.length < count) {
        this.fetchTableData(next.replace("/GISBusinessAPI", ""));
        this.tableContent.scrollTop = this.tableContent.scrollTop - 50;
      }
    }
  }
  componentWillUnmount() {
    const {
      removeData
    } = this.props;
    removeData();
    this.tableContent ? this.tableContent.removeEventListener("scroll", this.getMoreData) : null;
  }
  componentDidUpdate(prevProps) {
    if (!lodash_isEqual__WEBPACK_IMPORTED_MODULE_11___default()(prevProps.results, this.props.results)) {
      this.fetchTableData();
    }
  }
  render() {
    const {
      results = []
    } = this.props;
    const {
      columns
    } = this.state;
    const {
      tableHeight
    } = this;
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_14___default.a.createElement("div", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_14___default.a.createElement(antd_lib_table__WEBPACK_IMPORTED_MODULE_1___default.a, {
      bordered: true,
      rowKey: "id",
      dataSource: results,
      columns: columns,
      scroll: {
        y: tableHeight
      },
      pagination: false
    }));
  }
}
/* harmony default export */ __webpack_exports__["default"] = (Object(react_router__WEBPACK_IMPORTED_MODULE_20__["withRouter"])(Object(react_redux__WEBPACK_IMPORTED_MODULE_16__["connect"])(_mapping__WEBPACK_IMPORTED_MODULE_15__["mapStateToProps"], _mapping__WEBPACK_IMPORTED_MODULE_15__["mapDispatchToProps"])(Object(react_i18next__WEBPACK_IMPORTED_MODULE_19__["translate"])("labels")(tableComponent))));

/***/ }),

/***/ "./src/app/components/inputs/fields/table/mapping.js":
/*!***********************************************************!*\
  !*** ./src/app/components/inputs/fields/table/mapping.js ***!
  \***********************************************************/
/*! exports provided: mapStateToProps, mapDispatchToProps */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "mapStateToProps", function() { return mapStateToProps; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "mapDispatchToProps", function() { return mapDispatchToProps; });
const mapStateToProps = ({
  mainApp: {
    inputTable = {}
  }
}) => ({
  ...inputTable
});
const mapDispatchToProps = dispatch => {
  return {
    fillData: data => {
      dispatch({
        type: 'setMainApp',
        path: `inputTable`,
        data
      });
    },
    removeData: () => {
      dispatch({
        type: 'removeMainApp',
        path: 'inputTable'
      });
    },
    removeItemInResults: index => {
      dispatch({
        type: 'removeMainApp',
        path: `inputTable.results`,
        index
      });
    }
  };
};

/***/ }),

/***/ "./src/app/components/inputs/fields/table/tableActionFunctions.js":
/*!************************************************************************!*\
  !*** ./src/app/components/inputs/fields/table/tableActionFunctions.js ***!
  \************************************************************************/
/*! exports provided: deleteFunc */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "deleteFunc", function() { return deleteFunc; });
/* harmony import */ var _imports_config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../../imports/config */ "./src/imports/config.js");
/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! axios */ "./node_modules/axios/index.js");
/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(axios__WEBPACK_IMPORTED_MODULE_1__);


function deleteFunc({
  id
}, index, action) {
  const {
    removeItemInResults,
    t
  } = this.props;
  const {
    url
  } = action;
  const deleteUrl = `${url}${id}`;
  axios__WEBPACK_IMPORTED_MODULE_1___default.a.delete(_imports_config__WEBPACK_IMPORTED_MODULE_0__["workFlowUrl"] + deleteUrl).then(() => {
    window.notifySystem('success', t('Succesfully deleted'));
    removeItemInResults(index);
  }).catch(() => {
    window.notifySystem('error', t('Failed to delete'));
  });
}

/***/ })

}]);
//# sourceMappingURL=58.min.js.map