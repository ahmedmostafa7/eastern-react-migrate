(window["webpackJsonp"] = window["webpackJsonp"] || []).push([[103],{

/***/ "./src/app/components/inputs/fields/identify/Component/IdentifyServiceRange/index.js":
/*!*******************************************************************************************!*\
  !*** ./src/app/components/inputs/fields/identify/Component/IdentifyServiceRange/index.js ***!
  \*******************************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var antd_lib_message_style__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! antd/lib/message/style */ "./node_modules/antd/lib/message/style/index.js");
/* harmony import */ var antd_lib_message_style__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(antd_lib_message_style__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var antd_lib_message__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! antd/lib/message */ "./node_modules/antd/lib/message/index.js");
/* harmony import */ var antd_lib_message__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(antd_lib_message__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @babel/runtime/helpers/defineProperty */ "./node_modules/@babel/runtime/helpers/defineProperty.js");
/* harmony import */ var _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var antd_lib_select_style__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! antd/lib/select/style */ "./node_modules/antd/lib/select/style/index.js");
/* harmony import */ var antd_lib_select_style__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(antd_lib_select_style__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var antd_lib_select__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! antd/lib/select */ "./node_modules/antd/lib/select/index.js");
/* harmony import */ var antd_lib_select__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(antd_lib_select__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var lodash_get__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! lodash/get */ "./node_modules/lodash/get.js");
/* harmony import */ var lodash_get__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(lodash_get__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_6__);
/* harmony import */ var _common_esri_request__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../common/esri_request */ "./src/app/components/inputs/fields/identify/Component/common/esri_request.js");
/* harmony import */ var _common_common_func__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../common/common_func */ "./src/app/components/inputs/fields/identify/Component/common/common_func.js");
/* harmony import */ var _imports_config__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../../../../../imports/config */ "./src/imports/config.js");
/* harmony import */ var _common_esri_loader__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../common/esri_loader */ "./src/app/components/inputs/fields/identify/Component/common/esri_loader.js");
/* harmony import */ var _mapviewer_config_map__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../mapviewer/config/map */ "./src/app/components/inputs/fields/identify/Component/mapviewer/config/map.js");
/* harmony import */ var antd_dist_antd_css__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! antd/dist/antd.css */ "./node_modules/antd/dist/antd.css");
/* harmony import */ var antd_dist_antd_css__WEBPACK_IMPORTED_MODULE_12___default = /*#__PURE__*/__webpack_require__.n(antd_dist_antd_css__WEBPACK_IMPORTED_MODULE_12__);
/* harmony import */ var _MapComponent_MapComponent__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../MapComponent/MapComponent */ "./src/app/components/inputs/fields/identify/Component/MapComponent/MapComponent.js");
/* harmony import */ var _mapping__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../mapping */ "./src/app/components/inputs/fields/identify/Component/mapping.js");
/* harmony import */ var react_redux__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! react-redux */ "./node_modules/react-redux/es/index.js");
/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! axios */ "./node_modules/axios/index.js");
/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_16___default = /*#__PURE__*/__webpack_require__.n(axios__WEBPACK_IMPORTED_MODULE_16__);

















const {
  Option
} = antd_lib_select__WEBPACK_IMPORTED_MODULE_4___default.a;
class IdentifyServiceRange extends react__WEBPACK_IMPORTED_MODULE_6__["Component"] {
  constructor(props) {
    super(props);
    _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_2___default()(this, "mapLoaded", map => {
      this.map = map;
      this.props.setLoading(true);
      axios__WEBPACK_IMPORTED_MODULE_16___default.a.get(`${_imports_config__WEBPACK_IMPORTED_MODULE_9__["workFlowUrl"]}/CadLayers/GetAll`).then(response => {
        this.props.setLoading(false);
        response.data.results = response.data.results.filter(res => {
          return res.layer_description.indexOf('خدمات') > -1;
        });
        this.setState({
          servicesTypes: response.data.results
        });
      });
      var lands = lodash_get__WEBPACK_IMPORTED_MODULE_5___default()(this.props.mainObject, 'LandWithCoordinate.landData.lands');
      if (lands) {
        Object(_common_common_func__WEBPACK_IMPORTED_MODULE_8__["highlightFeature"])(lands.parcels, this.map, {
          layerName: "SelectLandsGraphicLayer",
          isZoom: true,
          zoomFactor: 10,
          isHighlighPolygonBorder: true,
          highlighColor: [0, 0, 0, 0.7]
        });
        setTimeout(() => {
          lands.parcels.forEach(land => {
            Object(_common_common_func__WEBPACK_IMPORTED_MODULE_8__["addParcelNo"])(land.geometry.getExtent().getCenter(), this.map, land.attributes.PARCEL_PLAN_NO + '', "ParcelPlanNoGraphicLayer", 18, [0, 0, 0]);
          });
        }, 1000);
      }
      this.setState({
        mapLoaded: true
      });
      this.selectedParcel = lands.parcels[0];
    });
    _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_2___default()(this, "zoomToParcel", f => {
      Object(_common_common_func__WEBPACK_IMPORTED_MODULE_8__["highlightFeature"])(this.selectedParcel, this.map, {
        layerName: "SelectLandsGraphicLayer",
        isZoom: true,
        zoomFactor: 10,
        isHighlighPolygonBorder: true,
        highlighColor: [0, 0, 0, 0.7]
      });
    });
    _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_2___default()(this, "clearBuffer", f => {
      this.map.getLayer("BufferGraphicLayer").clear();
    });
    _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_2___default()(this, "onServieTypeChange", f => {
      this.setState({
        serviceVal: f,
        serviceSubTypeVal: null,
        servicesSubTypes: this.state.servicesTypes.find(x => {
          return x.layer_code == f;
        }).cad_sublayers || []
      });
    });
    _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_2___default()(this, "onServieSubTypeChange", f => {
      this.setState({
        serviceSubTypeVal: f
      });
    });
    _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_2___default()(this, "updateBufferDistance", evt => {
      this.setState({
        bufferDistance: evt.target.value
      });
    });
    this.state = {
      mapLoaded: false,
      serviceVal: null,
      serviceSubTypeVal: null,
      servicesSubTypes: [],
      bufferDistance: null,
      servicesTypes: [],
      resultServices: [],
      lands: []
    };
  }
  componentDidMount() {
    Object(_common_common_func__WEBPACK_IMPORTED_MODULE_8__["getInfo"])().then(res => {
      // 
      this.LayerID = res;
    });
  }
  getServicesOnBuffer() {
    Object(_common_esri_loader__WEBPACK_IMPORTED_MODULE_10__["LoadModules"])(["esri/geometry/Circle"]).then(([Circle]) => {
      var circleGeometry = new Circle({
        center: this.selectedParcel.geometry.getExtent().getCenter(),
        radius: +this.state.bufferDistance,
        radiusUnit: esri.Units.METERS
      });
      Object(_common_common_func__WEBPACK_IMPORTED_MODULE_8__["highlightFeature"])(circleGeometry, this.map, {
        layerName: "BufferGraphicLayer",
        isZoom: true,
        zoomFactor: 10,
        isHiglightSymbol: true,
        highlighColor: [255, 0, 0, .4]
      });
      var where = "";
      if (this.state.serviceSubTypeVal) {
        where = "SRVC_SUBTYPE =" + this.state.serviceSubTypeVal;
      } else {
        console.log(this.state.servicesSubTypes);
        if (this.state.servicesSubTypes) {
          where = "SRVC_TYPE='" + (this.state.servicesSubTypes[0].sublayer_code + '').substring(0, 3) + "'";
        } else {
          where = "SRVC_TYPE=" + this.state.serviceVal;
        }
      }
      Object(_common_common_func__WEBPACK_IMPORTED_MODULE_8__["intersectQueryTask"])({
        url: _mapviewer_config_map__WEBPACK_IMPORTED_MODULE_11__["mapUrl"] + "/" + (this.LayerID.Serivces_Data || this.LayerID.Service_Data),
        geometry: circleGeometry,
        where: where,
        returnGeometry: true,
        outFields: ["SRVC_NAME"],
        callbackResult: res => {
          if (res.features && res.features.length == 0) {
            antd_lib_message__WEBPACK_IMPORTED_MODULE_1___default.a.warning("لا توجد نتائج لنطاق تأثير الخدمة المختارة");
          } else {
            Object(_common_common_func__WEBPACK_IMPORTED_MODULE_8__["highlightFeature"])(res.features, this.map, {
              layerName: "ZoomGraphicLayer",
              isZoom: true,
              zoomFactor: 10
            });
          }
          this.setState({
            resultServices: res.features
          });
        }
      });
    });
  }
  highlightService(feature) {
    Object(_common_common_func__WEBPACK_IMPORTED_MODULE_8__["highlightFeature"])(feature, this.map, {
      layerName: "highlightGraphicLayer",
      isHiglightSymbol: true,
      isZoom: true,
      zoomFactor: 10
    });
  }
  render() {
    const {
      mapLoaded,
      servicesTypes,
      servicesSubTypes,
      serviceSubTypeVal,
      serviceVal,
      resultServices
    } = this.state;
    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("div", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("div", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement(_MapComponent_MapComponent__WEBPACK_IMPORTED_MODULE_13__["default"], {
      mapload: this.mapLoaded.bind(this)
    })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("h1", {
      className: "titleSelectedParcel"
    }, "\u0646\u0637\u0627\u0642 \u0627\u0644\u062A\u0623\u062B\u064A\u0631"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("div", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("label", null, "\u0646\u0648\u0639 \u0627\u0644\u062E\u062F\u0645\u0629"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement(antd_lib_select__WEBPACK_IMPORTED_MODULE_4___default.a, {
      getPopupContainer: trigger => trigger.parentNode,
      onChange: this.onServieTypeChange,
      showSearch: true,
      autoFocus: true,
      disabled: !servicesTypes.length,
      optionFilterProp: "children",
      filterOption: (input, option) => {
        if (option.props.children) {
          var _option$props$childre, _option$props$childre2;
          return ((_option$props$childre = option.props.children) === null || _option$props$childre === void 0 ? void 0 : (_option$props$childre2 = _option$props$childre.toLowerCase()) === null || _option$props$childre2 === void 0 ? void 0 : _option$props$childre2.indexOf(input.toLowerCase())) >= 0;
        } else {
          return false;
        }
      },
      value: serviceVal,
      placeholder: "\u0646\u0648\u0639 \u0627\u0644\u062E\u062F\u0645\u0629",
      notFoundContent: "not found"
    }, servicesTypes.map((d, i) => {
      return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement(Option, {
        key: i,
        value: d.layer_code
      }, d.layer_description);
    })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("label", null, "\u0645\u0633\u062A\u0648\u0649 \u0627\u0644\u062E\u062F\u0645\u0629"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement(antd_lib_select__WEBPACK_IMPORTED_MODULE_4___default.a, {
      getPopupContainer: trigger => trigger.parentNode,
      onChange: this.onServieSubTypeChange,
      showSearch: true,
      autoFocus: true,
      disabled: !servicesSubTypes.length,
      optionFilterProp: "children",
      filterOption: (input, option) => {
        if (option.props.children) {
          var _option$props$childre3, _option$props$childre4;
          return ((_option$props$childre3 = option.props.children) === null || _option$props$childre3 === void 0 ? void 0 : (_option$props$childre4 = _option$props$childre3.toLowerCase()) === null || _option$props$childre4 === void 0 ? void 0 : _option$props$childre4.indexOf(input.toLowerCase())) >= 0;
        } else {
          return false;
        }
      },
      value: serviceSubTypeVal,
      placeholder: "\u0645\u0633\u062A\u0648\u0649 \u0627\u0644\u062E\u062F\u0645\u0629",
      notFoundContent: "not found"
    }, servicesSubTypes.map((d, i) => {
      return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement(Option, {
        key: i,
        value: d.sublayer_code
      }, d.sublayer_description);
    })), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("label", null, "\u0646\u0637\u0627\u0642 \u0627\u0644\u062A\u062E\u062F\u064A\u0645 \u0628\u0627\u0644\u0645\u062A\u0631"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("input", {
      className: "ant-input",
      type: "number",
      placeholder: "\u0646\u0637\u0627\u0642 \u0627\u0644\u062A\u062E\u062F\u064A\u0645 \u0628\u0627\u0644\u0645\u062A\u0631",
      required: true,
      value: this.state.bufferDistance,
      onChange: this.updateBufferDistance
    }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("button", {
      type: "button",
      disabled: !this.state.bufferDistance,
      className: "btn btn-primary",
      style: {
        width: "100px",
        marginTop: "20px",
        backgroundColor: "#337ab7"
      },
      onClick: this.getServicesOnBuffer.bind(this)
    }, " ", "\u0628\u062D\u062B", " "), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("button", {
      type: "button",
      className: "btn btn-primary",
      style: {
        width: "auto",
        marginTop: "20px",
        marginRight: "35px",
        backgroundColor: "#337ab7"
      },
      onClick: this.zoomToParcel.bind(this)
    }, " ", "\u062A\u0642\u0631\u064A\u0628 \u0625\u0644\u064A \u0627\u0644\u0623\u0631\u0636", " "), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("button", {
      type: "button",
      className: "btn btn-primary",
      style: {
        width: "auto",
        marginTop: "20px",
        marginRight: "35px",
        backgroundColor: "#337ab7"
      },
      onClick: this.clearBuffer.bind(this)
    }, " ", "\u0645\u0633\u062D \u0646\u0637\u0627\u0642 \u0627\u0644\u062A\u0623\u062B\u064A\u0631", " "), resultServices && resultServices.length > 0 && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("table", {
      className: "table table-bordered",
      style: {
        marginTop: "1%"
      }
    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("thead", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("th", null, "\u0627\u0633\u0645 \u0627\u0644\u062E\u062F\u0645\u0629"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("th", null)), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("tbody", null, resultServices.map(s => {
      return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("tr", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("td", null, s.attributes.SRVC_NAME), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("td", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_6___default.a.createElement("button", {
        className: "btn btn-warning",
        onClick: this.highlightService.bind(this, s)
      }, "\u062A\u0642\u0631\u064A\u0628")));
    })))));
  }
}
/* harmony default export */ __webpack_exports__["default"] = (Object(react_redux__WEBPACK_IMPORTED_MODULE_15__["connect"])(_mapping__WEBPACK_IMPORTED_MODULE_14__["mapStateToProps"], _mapping__WEBPACK_IMPORTED_MODULE_14__["mapDispatchToProps"])(IdentifyServiceRange));

/***/ })

}]);
//# sourceMappingURL=103.min.js.map