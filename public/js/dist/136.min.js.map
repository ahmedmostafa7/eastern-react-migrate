{"version":3,"file":"136.min.js","sources":["webpack:///./src/app/components/wizard/components/stepContent/sections/sectionTypes/wizardSummery/components/karar_amin.js"],"sourcesContent":["import React, { Component } from \"react\";\r\nimport { host } from \"config\";\r\nimport {withTranslation} from \"react-i18next\";\r\nimport { mapStateToProps, mapDispatchToProps } from \"../mapping\";\r\nimport { connect } from \"react-redux\";\r\nimport { followUp } from \"../../../../../../../../../apps/modules/tabs/tableActionFunctions\";\r\nimport moment from \"moment-hijri\";\r\nimport { postItem } from \"../../../../../../../../helpers/apiMethods\";\r\nclass Karar_amin extends Component {\r\n  print() {\r\n    const {\r\n      currentModule: { record },\r\n    } = this.props;\r\n    \r\n    followUp({ id: record.id }, 0, {}, null, false, this.props).then((res) => {\r\n      let aminStep = null;\r\n\r\n      if (record.app_id == 16) {\r\n      let primaryApprovalIndex = res?.prevSteps?.findLastIndex(\r\n        (step) => [2326, 3107].indexOf(step.prevStep.id) != -1\r\n      );\r\n\r\n      let aminSignPrimaryApprovalIndex = res?.prevSteps?.findLastIndex(\r\n        (step) => [2851, 3112].indexOf(step.prevStep.id) != -1\r\n      );\r\n\r\n      let finalApprovalIndex = res?.prevSteps?.findLastIndex(\r\n        (step) => [2372, 2330, 3119].indexOf(step.prevStep.id) != -1\r\n      );\r\n\r\n      \r\n      if (\r\n        aminSignPrimaryApprovalIndex > primaryApprovalIndex &&\r\n        (finalApprovalIndex == -1 ||\r\n          (finalApprovalIndex > -1 &&\r\n            finalApprovalIndex > aminSignPrimaryApprovalIndex))\r\n      ) {\r\n        aminStep = res?.prevSteps?.[aminSignPrimaryApprovalIndex];\r\n      }\r\n    } else if (record.app_id == 22) {\r\n      let aminSignAddedParcelIndex = res?.prevSteps?.findLastIndex(\r\n        (step) => [2856, 2859, 3011, 3013].indexOf(step.prevStep.id) != -1\r\n      );\r\n      aminStep = res?.prevSteps?.[aminSignAddedParcelIndex];\r\n    }\r\n\r\n      // let aminStep =\r\n      //   res?.prevSteps?.[\r\n      //     res?.prevSteps?.findLastIndex(\r\n      //       (step) => step?.name?.indexOf(\"أمين المنطقة الشرقية\") != -1\r\n      //     )\r\n      //   ];\r\n\r\n      let mainObject = this.props[\"mainObject\"];\r\n      let hijDate =\r\n       // mainObject[\"krar_amin\"]?.karar_amin_date ||\r\n        aminStep?.date ||\r\n        moment().format(\"iYYYY/iM/iD\");\r\n\r\n      mainObject[\"krar_amin\"] = {\r\n        karar_amin_date: hijDate,\r\n      };\r\n\r\n      mainObject[\"karar_amin_date\"] = hijDate;\r\n      const url = \"/Submission/SaveEdit\";\r\n      const params = { sub_id: record.id };\r\n      delete mainObject.temp;\r\n\r\n      postItem(\r\n        url,\r\n        { mainObject: window.lzString.compressToBase64(JSON.stringify({ ...mainObject})), tempFile: {} },\r\n        { params }\r\n      ).then(() => {\r\n        let id = record.id;\r\n        window.open(printHost + `/#/addedparcel_temp1/${id}`, \"_blank\");\r\n      });\r\n    });\r\n  }\r\n  render() {\r\n    const { karar_amin } = this.props.mainObject.krar_amin;\r\n    const { karar_amin_date } = this.props.mainObject;\r\n    let imgSrc = (karar_amin && karar_amin[\"attachment\"]) || \"\";\r\n    let karar_num = localStorage.getItem(\"req_no\");\r\n    console.log(\"GG\", this.props.mainObject);\r\n    return (\r\n      <div>\r\n        <table className=\"table table-bordered\">\r\n          <tbody>\r\n            <tr>\r\n              <td>رقم القرار</td>\r\n              <td>{karar_num}</td>\r\n            </tr>\r\n            <tr>\r\n              <td>تاريخ القرار</td>\r\n              <td>{karar_amin_date}</td>\r\n            </tr>\r\n            {imgSrc && (\r\n              <tr>\r\n                <td>نسخة من قرار معالي الأمين</td>\r\n                {imgSrc ? (\r\n                  <td>\r\n                    <a href={window.filesHost + `${imgSrc}`} target=\"_blank\">\r\n                      الملف المرفق\r\n                    </a>\r\n                  </td>\r\n                ) : (\r\n                  <td></td>\r\n                )}\r\n              </tr>\r\n            )}\r\n            <tr>\r\n              <td>طباعة قرار معالي الأمين</td>\r\n              <td>\r\n                <button\r\n                  className=\"btn add-btnT\"\r\n                  onClick={this.print.bind(this)}\r\n                >\r\n                  طباعة\r\n                </button>\r\n              </td>\r\n            </tr>\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(withTranslation(\"labels\")(Karar_amin));"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AAEA;AAAA;AACA;AAIA;AAIA;AAKA;AAKA;AACA;AACA;AACA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AACA;AAEA;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAeA;AAAA;AAAA;AAaA;AACA;AAAA;AAUA;AACA;AAEA;;;;A","sourceRoot":""}